# systemd-tmpfiles configuration for early recursive /var initialization
# This configuration ensures /var is populated from /usr/share/factory/var
# when the /var partition is empty (e.g., first boot with separate LVM volume)
#
# Placed in /usr/lib/tmpfiles.d/ for early boot processing by systemd-tmpfiles-setup.service
# Runs before sysinit.target, ensuring /var is ready before most services start

# C+! directive: Recursively copy factory template to /var if /var is empty
# Format: C+! <path> <mode> <uid> <gid> <age> <argument>
#
# Directive breakdown:
#   C   = Copy operation (non-recursive by default)
#   +   = Recursive modifier - descend into subdirectories
#   !   = Only execute if target path is empty or doesn't exist
#
# This ensures factory /var content is restored on:
# - First boot with empty /var volume
# - After /var volume is cleared/recreated
# - OSTree deployments where /var is shared but may need initialization
#
# Parameters:
#   /var: Target directory to populate
#   -: Preserve file mode from source (/usr/share/factory/var)
#   -: Preserve UID from source
#   -: Preserve GID from source
#   -: No age-based cleanup
#   -: No argument (source path inferred from /usr/share/factory/var)
#
# The factory template (/usr/share/factory/var) is created during image build
# by copying the populated /var directory to /usr/share/factory/var in rootfs
#
# Benefits:
# - /var persists across OSTree updates (on separate LVM volume)
# - Easy recovery: clear /var volume and reboot to restore from factory
# - Idempotent: only copies if /var is empty, won't overwrite existing data
C+! /var - - - - -
