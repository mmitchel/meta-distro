# U-Boot EFI Secure Boot configuration fragment
# Copyright (c) 2026 DISTRO Project
# SPDX-License-Identifier: MIT
#
# Configuration reference: https://docs.u-boot.org/en/latest/develop/uefi/uefi.html

# ============================================================================
# Core EFI Support (MANDATORY for EFI payload)
# ============================================================================

# Enable EFI support (general)
CONFIG_EFI=y

# Enable EFI loader - required for EFI payload boot
CONFIG_EFI_LOADER=y

# Enable BOOTEFI command - required to boot EFI images
CONFIG_CMD_BOOTEFI=y

# ============================================================================
# Block Device and Partition Support (MANDATORY for disk access)
# ============================================================================

# Enable block device support
CONFIG_BLK=y

# Enable partition table support
CONFIG_PARTITIONS=y

# Enable DOS/MBR partition table support
CONFIG_DOS_PARTITION=y

# Enable GPT partition table support (MANDATORY for discoverable partitions)
CONFIG_EFI_PARTITION=y

# ============================================================================
# EFI Secure Boot Configuration
# ============================================================================

# Enable EFI Secure Boot
CONFIG_EFI_SECURE_BOOT=y

# Enable EFI Variable Authentication
CONFIG_EFI_VARIABLE_AUTHENTICATION=y

# Enable authentication variables support
CONFIG_EFI_VARIABLE_FILE_STORE=y

# Enable signature verification
CONFIG_EFI_SIGNATURE_SUPPORT=y

# ============================================================================
# TPM and Measured Boot Support
# ============================================================================

# Enable TCG2 protocol for TPM integration
CONFIG_EFI_TCG2_PROTOCOL=y

# Enable measured boot
CONFIG_MEASURED_BOOT=y

# ============================================================================
# Cryptography and Verification
# ============================================================================

# Enable SHA256 for signature verification
CONFIG_SHA256=y

# Enable RSA for signature verification
CONFIG_RSA=y
CONFIG_RSA_VERIFY=y

# Enable certificate verification
CONFIG_X509_CERTIFICATE_PARSER=y
CONFIG_PKCS7_MESSAGE_PARSER=y

# ============================================================================
# EFI Capsule Updates
# ============================================================================

# Enable EFI capsule updates
CONFIG_EFI_CAPSULE_FIRMWARE_MANAGEMENT=y
CONFIG_EFI_CAPSULE_AUTHENTICATE=y

# ============================================================================
# Boot Configuration
# ============================================================================

# Boot delay for secure boot
CONFIG_BOOTDELAY=5

# Enable EFI boot menu
CONFIG_EFI_BOOTMGR=y

# ============================================================================
# Storage Device Support
# ============================================================================

# Enable USB support (optional, but useful for QEMU and real hardware)
CONFIG_USB=y
CONFIG_USB_STORAGE=y

# Enable NVMe support (optional, for high-performance disks)
CONFIG_NVME=y
